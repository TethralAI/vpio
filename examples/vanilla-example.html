<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibePay Vanilla JavaScript Integration Example</title>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f7f9fc;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .pay-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .pay-button:hover {
            transform: translateY(-2px);
        }

        .pay-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }

        .api-info {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-size: 14px;
            border: 1px solid #ffeaa7;
        }

        code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        .javascript-logo {
            color: #f7df1e;
            background: #323330;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }

        .payment-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="javascript-logo">JS</span> VibePay Vanilla JavaScript Integration</h1>

        <p style="text-align: center; margin-bottom: 30px; color: #666;">
            This example demonstrates how to integrate VibePay payments using pure JavaScript.
            No frameworks required - just vanilla JS and the Stripe.js library.
        </p>

        <!-- Payment Form -->
        <div class="payment-form">
            <div class="form-group">
                <label for="amount">Payment Amount ($)</label>
                <input type="number" id="amount" value="10" min="0.50" step="0.01">
            </div>

            <div class="form-group">
                <label for="description">Payment Description (Optional)</label>
                <input type="text" id="description" placeholder="What is this payment for?">
            </div>
        </div>

        <!-- Pay Button -->
        <button id="payButton" class="pay-button">
            Pay $<span id="amountDisplay">10.00</span>
        </button>

        <!-- Status Messages -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Integration Information -->
        <div class="api-info">
            <h3>⚡ Integration Notes for Vibe Platform Developers:</h3>
            <ul>
                <li><strong>Pure JavaScript:</strong> No frameworks or build tools required</li>
                <li><strong>API Endpoint:</strong> <code id="apiEndpoint">http://localhost:3000/api/payments/create</code></li>
                <li><strong>Authentication:</strong> Include <code>x-api-key</code> header with your VibePay API key</li>
                <li><strong>Amount:</strong> Specified in dollars (e.g., 10 = $10.00)</li>
                <li><strong>Fee:</strong> VibePay automatically adds 0.5% processing fee</li>
                <li><strong>Response:</strong> Contains <code>clientSecret</code> for Stripe confirmation</li>
            </ul>

            <h4>📋 Required Configuration:</h4>
            <div class="code-example">
const CONFIG = {
    apiUrl: 'http://localhost:3000',           // Your VibePay API endpoint
    apiKey: 'vibe-test-key-1',                // Your VibePay API key
    stripePublishableKey: 'pk_test_51...'     // Your Stripe publishable key
};</div>

            <h4>🎯 Vanilla JavaScript Implementation:</h4>
            <ul>
                <li><strong>DOM Manipulation:</strong> Direct element selection and event handling</li>
                <li><strong>Fetch API:</strong> Modern promise-based HTTP requests</li>
                <li><strong>Event Listeners:</strong> Button clicks and form interactions</li>
                <li><strong>Dynamic Updates:</strong> Real-time UI updates without page reloads</li>
            </ul>

            <h4>🔧 Key Functions:</h4>
            <div class="code-example">
// Create payment intent
const response = await fetch('/api/payments/create', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'x-api-key': CONFIG.apiKey
    },
    body: JSON.stringify({ amount: 10 })
});

// Confirm payment with Stripe
const result = await stripe.confirmCardPayment(clientSecret);</div>
        </div>
    </div>

    <script>
        // VibePay Vanilla JavaScript Integration
        // This example shows how to integrate VibePay payments using pure JavaScript

        // Configuration - Update these for your environment
        const CONFIG = {
            // VibePay API endpoint - change to your production URL
            apiUrl: 'http://localhost:3000',

            // Your VibePay API key - get this from your VibePay dashboard
            apiKey: 'vibe-test-key-1',

            // Your Stripe publishable key - get this from your Stripe dashboard
            stripePublishableKey: 'pk_test_51...' // Replace with your actual Stripe publishable key
        };

        // Global variables
        let stripe = null;
        let isLoading = false;

        // DOM elements
        const payButton = document.getElementById('payButton');
        const amountInput = document.getElementById('amount');
        const amountDisplay = document.getElementById('amountDisplay');
        const descriptionInput = document.getElementById('description');
        const statusMessage = document.getElementById('statusMessage');
        const apiEndpoint = document.getElementById('apiEndpoint');

        // Initialize Stripe when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 VibePay Vanilla JS Integration loaded');

            // Update API endpoint display
            apiEndpoint.textContent = `${CONFIG.apiUrl}/api/payments/create`;

            // Initialize Stripe
            if (window.Stripe && CONFIG.stripePublishableKey.startsWith('pk_')) {
                stripe = window.Stripe(CONFIG.stripePublishableKey);
                console.log('✅ Stripe initialized');
            } else {
                showStatus('Please configure your Stripe publishable key in CONFIG.stripePublishableKey', 'error');
                payButton.disabled = true;
            }

            // Set up event listeners
            setupEventListeners();
        });

        // Set up all event listeners
        function setupEventListeners() {
            // Pay button click handler
            payButton.addEventListener('click', handlePayment);

            // Amount input change handler
            amountInput.addEventListener('input', function() {
                const amount = parseFloat(amountInput.value) || 0;
                amountDisplay.textContent = amount.toFixed(2);
            });

            // Enter key handler for inputs
            amountInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handlePayment();
                }
            });

            descriptionInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handlePayment();
                }
            });
        }

        // Main payment processing function
        async function handlePayment() {
            if (!stripe) {
                showStatus('Stripe not initialized. Please check your configuration.', 'error');
                return;
            }

            if (isLoading) {
                return; // Prevent double-clicks
            }

            // Get form values
            const amount = parseFloat(amountInput.value);
            const description = descriptionInput.value.trim();

            // Validate amount
            if (!amount || amount < 0.50) {
                showStatus('Amount must be at least $0.50', 'error');
                return;
            }

            setLoading(true);
            showStatus('Creating payment intent...', 'loading');

            try {
                // Step 1: Create payment intent through VibePay API
                console.log('📤 Creating payment intent for $' + amount);

                const response = await fetch(`${CONFIG.apiUrl}/api/payments/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': CONFIG.apiKey
                    },
                    body: JSON.stringify({
                        amount: amount,
                        currency: 'usd',
                        metadata: {
                            source: 'vanilla-js-example',
                            platform: 'vibe',
                            description: description || 'VibePay test payment'
                        }
                    })
                });

                console.log('📥 Response received:', response.status);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Payment creation failed');
                }

                const paymentData = await response.json();
                console.log('✅ Payment intent created:', paymentData.id);

                showStatus('Processing payment with Stripe...', 'loading');

                // Step 2: Simulate Stripe payment confirmation
                // In a real application, you would use Stripe Elements to collect card details
                // and then call stripe.confirmCardPayment() with the actual card information

                // For this demo, we'll simulate the payment process
                await simulateStripePayment(paymentData);

                // Step 3: Handle successful payment
                const totalAmount = paymentData.amount.toFixed(2);
                const fee = paymentData.fee.toFixed(2);

                showStatus(
                    `✅ Payment successful!
                     Payment ID: ${paymentData.id}
                     Amount charged: $${totalAmount} (includes $${fee} VibePay fee)`,
                    'success'
                );

                console.log('🎉 Payment completed successfully');

                // Optional: Reset form
                setTimeout(() => {
                    descriptionInput.value = '';
                    hideStatus();
                }, 5000);

            } catch (error) {
                console.error('❌ Payment error:', error);
                showStatus(`❌ Payment failed: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        }

        // Simulate Stripe payment confirmation (for demo purposes)
        async function simulateStripePayment(paymentData) {
            return new Promise((resolve) => {
                // Simulate network delay
                setTimeout(() => {
                    console.log('💳 Simulated Stripe payment confirmation');
                    resolve();
                }, 1500);
            });
        }

        // Utility function to show status messages
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
        }

        // Utility function to hide status messages
        function hideStatus() {
            statusMessage.style.display = 'none';
        }

        // Utility function to manage loading state
        function setLoading(loading) {
            isLoading = loading;
            payButton.disabled = loading;
            payButton.textContent = loading ? 'Processing...' : `Pay $${amountDisplay.textContent}`;
        }

        // Additional utility functions for Vibe platform developers

        // Function to check VibePay API health
        async function checkAPIHealth() {
            try {
                const response = await fetch(`${CONFIG.apiUrl}/health`);
                const health = await response.json();
                console.log('🏥 API Health:', health);
                return health.status === 'healthy';
            } catch (error) {
                console.error('❌ Health check failed:', error);
                return false;
            }
        }

        // Function to get payment status
        async function getPaymentStatus(paymentId) {
            try {
                const response = await fetch(`${CONFIG.apiUrl}/api/payments/${paymentId}`, {
                    headers: {
                        'x-api-key': CONFIG.apiKey
                    }
                });
                const status = await response.json();
                console.log('📊 Payment status:', status);
                return status;
            } catch (error) {
                console.error('❌ Status check failed:', error);
                return null;
            }
        }

        // Expose utility functions to global scope for debugging
        window.VibePay = {
            checkAPIHealth,
            getPaymentStatus,
            CONFIG
        };

        console.log('🛠️ VibePay utilities available: window.VibePay');
    </script>
</body>
</html>